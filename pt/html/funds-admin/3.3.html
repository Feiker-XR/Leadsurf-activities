<!DOCTYPE HTML>
<html lang="en-US" class="html-content">
	<head>
		<meta charset="UTF-8">
		<title>3.3人工批量操作</title>
		<link rel="stylesheet" href="../images/common/base.css" />
		<link rel="stylesheet" href="../images/admin/admin.css" />
		<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="../js/phoenix.base.js"></script>
		<script type="text/javascript" src="../js/phoenix.Class.js"></script>
		<script type="text/javascript" src="../js/phoenix.Event.js"></script>
		<script type="text/javascript" src="../js/phoenix.util.js"></script>
		<script type="text/javascript" src="../js/phoenix.Mask.js"></script>
		<script type="text/javascript" src="../js/phoenix.Tab.js"></script>
		<script type="text/javascript" src="../js/phoenix.Input.js"></script>
		<script type="text/javascript" src="../js/phoenix.MiniWindow.js"></script>
		<script type="text/javascript" src="../js/phoenix.Message.js"></script>
		<script type="text/javascript" src="../js/phoenix.Tree.js"></script>
	</head>
	<body class="">
		<div class="menu">
			<div class="menu-logo"></div>
			<ul class="menu-list">
				<li><a href="">首页</a></li>
				<li><a href="">全局</a></li>
				<li><a href="">用户</a></li>
				<li><a href="">游戏</a></li>
				<li><a href="">资金</a></li>
				<li><a href="">市场促销</a></li>
				<li><a href="">统计</a></li>
				<li><a href="">内容</a></li>
				<li><a href="">权限</a></li>
			</ul>
			<div class="menu-quit"><a href="">退出</a><i class="ico-user"></i>你好，vava</div>
		</div>
		<div class="col-content">
			<div class="col-side">
				<dl class="nav">
					<dt>充值相关</dt>
					<dd><a href="">异常充值处理</a></dd>
					<dd><a href="">充值相关配置</a></dd>
					<dt>提现相关</dt>
					<dd><a href="">风险提现处理</a></dd>
					<dd><a href="#">提现相关处理</a></dd>
					<dt>人工资金操作</dt>
					<dd class="current"><a href="#">人工资金操作审核流程</a></dd>
					<dt>银行卡相关</dt>
					<dd><a href="#">银行管理</a></dd>
					<dd><a href="#">用户银行卡绑定管理</a></dd>
					<dd><a href="#">银行卡黑名单管理</a></dd>
					<dt>统计报表</dt>
					<dd><a href="#">充值明细报表</a></dd>
					<dd><a href="#">提现明细报表</a></dd>
					<dd><a href="#">充提报表</a></dd>
					<dd><a href="#">总代每日报表</a></dd>
					<dd><a href="#">自动收款明细报表</a></dd>
					<dt>转账相关</dt>
					<dd><a href="#">转账明细</a></dd>
					<dd><a href="#">转账限额配置</a></dd>
				</dl>
			</div>
			<div class="col-main">
				<div class="col-crumbs"><div class="crumbs"><strong>当前位置：</strong>资金 &gt;<a href="#">人工资金操作</a> &gt; 人工批量 </div></div>
				<div class="col-content">
					<div class="col-main">
						<div class="main">
							<ul class="ui-tab-title ui-tab-title2 clearfix" id="Tabs">
								<li class=""><a href="3.3.1.html">未处理</a></li>
								<li class=""><a href="3.3.2.html">已完成</a></li>
								<li class="current"><a href="3.3.html">批量上传</a></li>
							</ul>
							<h3 class="ui-title">
							1.批量上传
							</h3>
							<ul class="ui-form">
								<li>
									<label class="ui-label big">建单类型：</label>
									<select class="ui-select w-3">
										<option value="所有">请选择人工建单类型</option>
										<option value="可疑卡">打款 - 活动中奖</option>
										<option value="骗子卡">打款 - 人工提现</option>
										<option value="加币 - 活动加币">加币 - 活动加币</option>
										<option value="加币 - 大客户预支">加币 - 大客户预支</option>
										<option value="加币 - 投诉理赔">加币 - 投诉理赔</option>
										<option value="加币 - 平台奖励">加币 - 平台奖励</option>
										<option value="加币 - 重复打款">加币 - 重复打款</option>
										<option value="加币 - 人工扣款">加币 - 人工扣款</option>
									</select>
									<span class="ui-text-info">请慎重选择建单类型，并填写清楚建单原因</span>
								</li>
								<li>
									<form id="J-form-file" method="post" enctype="multipart/form-data" action="./manualResult.php" target="check_file_frame">
										<label class="ui-label big">上传文件：</label>
										<input type="file" name="file" value="" class="input w-4 file">
										<input id="J-file-updata" type="submit" value="载入文件" class="btn btn-important">
										<input id="J-reset-form" type="reset" style="outline:none;-ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=0);filter:alpha(opacity=0);opacity: 0;width:0px; height:0px;z-index:1;background:#000">
										<iframe src="./manualResult.php" name="check_file_frame" style="display:none;"></iframe>
									</form>
								</li>
								<li>
									<h4 class="ui-label">注意信息：</h4>
									<p class="ui-multiline">
									1) 请点击浏览按钮，选择本地准备好用于批量充值的Excel文档。<br>
									2) 统一转换成xxxx版的Excel文档，<span class="color-red">看系统支持哪个版本的Excel</span>，然后点击载入文件按钮预览按钮<br>
									3) 仔细核对文档，不要重复充值，错误金额等，确认无误后，点击最下面的批量充值按钮进行充值<br>
									4) 一次性充值量不能太大，最大500条记录
									</p>
								</li>
								<li>
									<h4 class="ui-label">表单校验：</h4>
									<p class="ui-multiline">
									1) 用户名必须是在平台存在，否则不能提交<br>
									2) 金额必须为“数字”， <span class="color-red">金额不能大于5000.00元</span><br>
									3) 备注不能为空
									</p>
								</li>
							</ul>
							<div class="ui-title"></div>
							<form id="J-amount-rules" action="#" method="post">
								<ul class="ui-form">
									<li>
										<label class="ui-label"></label>
										<div id="J-table-data" class="select-position">
											您还没有上传任何加币规则
										</div>
									</li>
									<li>
										<label class="ui-label"></label>
										<input id="J-add-amount" type="submit" class="btn-submit" value="批量加币">
									</li>
								</ul>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
	;(function($){
		var $button = $('#J-file-updata'),
			$buttonb = $('#J-add-amount');

		$button.bind('click', function(e) {
			var form = $(this).parent();
			checkFile(form.find('.file').get(0), form);
			e.preventDefault();
		});

		$buttonb.bind('click', function(e) {
			updataRules();
			e.preventDefault();
		});


		//检测上传
		var checkFile = function(dom, form) {
			var result = dom.value,
				fileext = result.substring(result.lastIndexOf("."), result.length),
				fileext = fileext.toLowerCase();

			if (fileext != '.xlsx') {
				alert("对不起，导入数据格式必须是.xlsx格式文件哦，请您调整格式后重新上传，谢谢 ！");
				return false;
			}

			form[0].submit();
		};

		//接收文件
		window.getFile = function(data) {
			var formArea = $('#J-table-data'),
				$resetDom = $('#J-reset-form');

			if (Number(data['isSuccess'] == 1)) {

				if (data['data']) {
					formArea.html(data['data']);
				}
			}

			$resetDom.trigger('click');
		}

		//上传加币规则
		updataRules= function(e){
			var rulesForm = $('#J-amount-rules'),
				data = rulesForm.serialize(),
				formArea = $('#J-table-data'),
				msg = new phoenix.Message();

			$.ajax({
				url: 'manualResult.php',
				type: 'post',
				dataType: 'json',
				data: data,
			})
			.done(function(r) {

				if (Number(r['isSuccess'] == 1)) {
					msg.show({
						content:'上传成功，请在未处理页面中查看',
						time: 3
					})
					formArea.text('您还没有上传任何加币规则');
				}

			})
			.fail(function() {
				//console.log("error");
			})
			.always(function() {
				//console.log("complete");
			});
		}

	})(jQuery);
	</script>
</html>