<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>唯一附言</title>
	<link rel="stylesheet" href="../images/common/base.css" />
	<link rel="stylesheet" href="../images/common/js-ui.css" />
	<link rel="stylesheet" href="../images/funds/funds.css" />
	<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../js/phoenix.base.js"></script>
	<script type="text/javascript" src="../js/phoenix.Class.js"></script>
	<script type="text/javascript" src="../js/phoenix.Event.js"></script>
	<script type="text/javascript" src="../js/phoenix.util.js"></script>
	<script type="text/javascript" src="../js/phoenix.Mask.js"></script>
	<script type="text/javascript" src="../js/phoenix.MiniWindow.js"></script>
	<script type="text/javascript" src="../js/phoenix.Message.js"></script>
</head>
<body>
	<!-- toolbar start -->
	<div class="bg-toolbar"></div>
	<div class="toolbar">
		<div class="g_33">
				<ul class="menu">
					<li class="user hover">
						<a href="#">您好，VIC<i class="tri"></i></a>
						<div class="menu-nav" style="display:none;">
							<i class="tri"></i>
							<a href="">游戏记录</a>
							<a href="">报表管理</a>
							<a href="">资金明细</a>
							<a href="">安全中心</a>
						</div>
					</li>
					<li class="msg">
						<a href="#" class="msg-title">12</a>
						<div class="msg-box" style="display:none;">
							<div class="msg-hd"><i class="tri"></i><a href="#" class="more">更多</a>我的未读消息<strong>（12）</strong></div>
							<div class="msg-bd">
								<a href="">这里是消息提示提示消息</a>
								<a href="">这里是消息提示提示消息</a>
								<a href="">这里是消息提示提示消息</a>
								<a href="">这里是消息提示提示消息这里是消息提示提示消息这里是消息提示提示消息这里是消息提示提示消息</a>
							</div>
						</div>
					</li>
					<li class="balance">余额：10000.00</li>
					<li class="recharge"><a href="#">充值</a></li>
					<li class="withdrawals"><a href="#">提现</a></li>
					<li class="quit"><a href="#">退出</a></li>
				</ul>
		</div>
	</div>
	<!-- toolbar end -->
	<!-- header start -->
	<div class="header">
		<div class="g_33">
			<h1 class="logo"><a title="首页" href="#">PH158</a></h1>
			<div class="service">
				<a title="客服" class="link-service" href="#">客服</a>
				<a title="帮助" class="link-help" href="#">帮助</a>
			</div>
		</div>
	</div>
	<!-- header end -->
	
	<div class="g_33 common-main">
		<div class="g_5">
			<div class="common-side">
				<div class="nav-side">
					<dl class="side-bet">
						<dt class="title">投注管理</dt>
						<dd><a href="../bet/1.1bet-bets.html">游戏记录</a></dd>
						<dd><a href="../bet/1.7bet-chas.html">追号记录</a></dd>
						<dd><a href="../bet/1.7bet-chas.html">账户明细</a></dd>
					</dl>
					<dl class="side-safe">
						<dt class="title">账户安全</dt>
						<dd><a href="../ucenter/2.3safe-safe.html">安全中心</a></dd>
						<dd><a href="../ucenter/2.3safe-safe.html">银行卡管理</a></dd>
						<dd><a href="../ucenter/2.1safe-personal.html">个人资料</a></dd>
						<dd><a href="../ucenter/2.11-2.12safe-change-pwd.html">密码管理</a></dd>
					</dl>
					<dl class="side-service">
						<dt class="title">服务</dt>
						<dd><a href="../service/3.1service-inbox.html">积分</a></dd>
						<dd><a href="../service/3.1service-inbox.html">红包</a></dd>
						<dd><a href="../service/3.1service-inbox.html">站内信</a></dd>
					</dl>
					<dl class="side-proxy">
						<dt class="title">代理中心</dt>
						<dd><a href="../proxy/4.1proxy-index.html">卡户</a></dd>
						<dd><a href="../proxy/4.23proxy-account-center-management.html">开户中心</a></dd>
						<dd><a href="../proxy/4.2proxy-customer-management.html">客户管理</a></dd>
						<dd><a href="../proxy/4.15proxy-report-query.html">报表查询</a></dd>
					</dl>
					<dl class="side-funds">
						<dt class="title">代理中心</dt>
						<dd><a href="../proxy/4.1proxy-index.html">我要充值</a></dd>
						<dd><a href="../proxy/4.23proxy-account-center-management.html">我要提现</a></dd>
						<dd><a href="../proxy/4.2proxy-customer-management.html">上下级转账</a></dd>
						<dd><a href="../funds/6.html">唯一附言</a></dd>
					</dl>
				</div>
			</div>
		</div>
		
		
		<div class="g_28 g_last">
			<div class="common-content">
				<div class="title">唯一附言</div>
				<div class="content">
					<div class="notice"><i class="ico-warning"></i>为了防止您的充值附言填写错误，请设置您的充值附言，设置成功后将可以使用您的唯一附言进行充值。</div>
				
					<ul id="J-recharge" class="recharge">
						<li>
							<label class="ui-label">唯一附言：</label>
							<span class="code-area"></span>
							<a id="cancel-annex" class="cancel" href="#">取消唯一附言</a>
							<a id="edit-annex" class="edit" href="#">修改附言</a>
							<span>（每30天最多可修改一次）</span>
							<div>
								<label class="ui-label"></label>
								<input class="rechargebutton btn" type="button" value="立即充值" />
							</div>
						</li>
					</ul>
					<ul id="J-apply-form" class="ui-form">
						<li>
							<label class="ui-label">选择获取方式：</label>
							<select id="J-method-change" class="ui-select" style="width:140px;">
								<option value="0">---请选择-----------</option>
								<option value="1">系统生成</option>
								<option value="2">自定义</option>
							</select>
							<span id="J-select-desc"></span>
						</li>
						<li id="J-system-generate" class="system-generate">
							<div id="J-code-area" class="code-area">c1254</div>
							<input id="J-reacquire" type="button" class="reacquire" value="重新获取（30）" />
							<p>
								请记住您获得的唯一附言！（不区分大小写）
							</p>
							<a class="enter-code btn" type="submit">确认</a>
							<a class="goback-step btn" type="submit">返回</a>
						</li>
						<li id="J-canceled" class="canceled">
							<label class="ui-label"></label>
							<span class="ui-text-prompt">对不起，您已于 2014/01/01 取消了唯一附言服务，30天内无法再次设置。</span>
						</li>
						<li id="J-apply-area" class="ui-btn">
							<a id="J-apply-button" href="javascript:void(0);" class="btn">立即获取<b class="btn-inner"></b></a>
						</li>
						<li id="J-custom" class="custom">
							<input id="J-custom-id" type="text" class="customId" value="" />
							<span id="J-custom-desc">请输入任意6-16位的数字与字母组合。（不区分大小写）</span>
							<div>
								<a class="enter-code btn" type="submit">确认</a>
								<a class="goback-step btn" type="submit">返回</a>
							</div>
						</li>
					</ul>

				</div>
			</div>
		</div>
	</div>

	<div class="footer footer-important">
		<div class="g_33">
			<span class="copy">&copy; 2001-2012 591PH. All right reserved. 凤凰游戏平台版权所有</span><a href="#">帮助中心</a> | <a href="#">在线客服</a> | <a href="#">游戏介绍</a> | <a href="#">下载客户端</a> | <a href="#">翻墙工具</a>
		</div>
	</div>


<script>
(function($){
	var// message = new phoenix.Message,
		countDownTime = null,
		countDownNum = 30,
		checkResultNum = null,
		selectDom = $('#J-method-change'),
		buttonAreaDom = $('#J-apply-area'),
		showTimeAreaDom = $('#J-reacquire'),
		showTimeArea = $('#J-reacquire'),
		customDom = $('#J-custom'),
		generate = $('#J-system-generate'),
		applyButtonDom = $('#J-apply-button'),
		customAreaDom = $('#J-custom-id'),
		customDescDom = $('#J-custom-desc'),
		rechargeDom = $('#J-recharge'),
		goBackButtonDom = $('.goback-Step');

	//获取
	getCodeNum = function(typeId) {
		var codeArea = $('#J-code-area');
		
		$.ajax({
			url: 'systemgenerate.json',
			type: 'GET',
			dataType: 'json',
			cache: false
			//data: {param1: 'value1'},
		})
		.done(function(r) {
			
			if(r.isSuccess == 1) {
				buttonAreaDom.hide();
				generate.show();

				//重新获取倒计时
				startCountDown();
				//显示结果
				codeArea.text(r['data']['code']);
				//缓存结果
				checkResultNum = r['data']['code'];
				//禁用下拉
				selectDom.attr('disabled','disabled');
			}
		})
		.fail(function() {

			checkResultNum = null;
			//console.log("error");
		})
		.always(function() {
			//console.log("complete");
		});
	}

	//获取倒计时
	startCountDown = function() {

		showTimeArea.attr('disabled','disabled');

		showTimeArea.val('重新获取（'+ countDownNum +'）');

		countDownNum--;

		countDownTime = setInterval(function() {

			showTimeArea.val('重新获取（'+ countDownNum +'）');
			
			//倒计时结束
			if(countDownNum == 0) {
				stopCountDown();
			}else {
				countDownNum--;
			}
		},1000);
	}

	//停止计时
	stopCountDown = function() {

		if(countDownTime) {
			showTimeArea.removeAttr('disabled').val(' 重新获取 ');
			clearInterval(countDownTime);
			countDownTime = null;
			countDownNum = 30;
		}
	}

	//返回第一步选择
	goBackStep = function() {
		//禁用下拉
		selectDom.removeAttr('disabled');
		//隐藏自定义区域
		customDom.hide();
		//隐藏系统生成区域
		generate.hide();
		//显示获取按钮
		buttonAreaDom.show();
		//停止获取计时
		stopCountDown();
		//重置结果
		checkResultNum = null;
	}

	//自定义号码
	customCode = function() {
		
		//展开自定义区域	
		customDom.show();
		//收起
		buttonAreaDom.hide();
		//
		selectDom.attr('disabled','disabled');
	}

	//校验自定义号码
	checkCustomNum = function(text) {
		var result,
			testRule = /^[0-9a-zA-Z]{6,16}$/g;

		if(!text) {
			return;
		}

		result = testRule.test(text);

		if(result) {

			$.ajax({
				url: 'checkcustomcode.json',
				type: 'GET',
				dataType: 'json',
				data: {code: text},
			})
			.done(function(r) {
					
				if(r['isSuccess'] == 1) {
					if(r['type'] == 0) {
						customDescDom.text('');
						checkResultNum = text;
					}else {
						checkResultNum = null;
						customDescDom.text(r['msg']);
					}
				}
			})
			.fail(function() {
				checkResultNum = null;
				//console.log("error");
			})
			.always(function() {
				//console.log("complete");
			});
			
		}else {

			checkResultNum = null;
			customDescDom.text('请输入任意6-16位的数字与字母组合');
		}
	}

	//确认使用附言
	submitCodeNum= function() {
		
		if(checkResultNum) {
			$('#J-apply-form').hide();
			rechargeDom.find('.code-area').text(checkResultNum);
			rechargeDom.show();
		}

		
	}

	//重新获取
	showTimeAreaDom.on('click', function() {
		var methodTypeId = selectDom.val();

		//获取附言号码
		getCodeNum(methodTypeId);
	});

	applyButtonDom.on('click', function(e){
		var methodTypeId = selectDom.val();
		
		//系统生成
		if(methodTypeId == 1) {

			//获取附言号码
			getCodeNum(methodTypeId);
		
		//自定义
		}else if(methodTypeId == 2) {

			//自定义
			customCode();
		}
	});

	//返回按钮
	goBackButtonDom.on('click', function() {

		goBackStep();
	});

	//自定义号码校验
	customAreaDom.on('blur', function() {
		var text = $.trim($(this).val());

		checkCustomNum(text);
	});

	//确认使用号码
	$('.enter-code').on('click', function() {
		
		submitCodeNum();
	});

	//取消附言
	$('#cancel-annex').on('click', function() {

		//确认取消弹窗
		message.show({
			mask: true,
			content: '<div class="bd text-center"><div class="pop-title"><i class="ico-waring"></i><h4 class="pop-text" style="width:360px;">请注意，取消后您将不能享受唯一附言充值服务，且30天内无法再次启用。</h4></div></div>',
			confirmIsShow: true,
			confirmText: '确定取消',
			confirmFun: function() {
				message.show({
					mask: true,
					content: '<div class="bd text-center"><div class="pop-title"><i class="ico-success"></i><h4 class="pop-text" style="width:360px;">取消成功，您已取消唯一附言服务。</h4></div></div>',
					confirmIsShow: true,
					confirmFun: function() {
						var date = new Date();

						this.hide();
						goBackStep();
						$('#J-select-desc').html('对不起，您已于 <span class="color-red">'+ date.getFullYear() +'/'+ (date.getMonth()+1)+'/'+date.getDate() +' </span>取消了唯一附言服务，30天内无法再次设置。');
						selectDom.attr('disabled','disabled').val(0);
						rechargeDom.hide();
						$('#J-apply-form').show();
					}
				});
			},
			cancelIsShow: true,
			cancelText: '取消',
			cancelFun: function() {
				this.hide();
			}
		});
	});

	//修改附言
	$('#edit-annex').on('click', function() {

		goBackStep();
		rechargeDom.hide();
		$('#J-apply-form').show();
	});	

})(jQuery);
</script>




















</body>

</html>