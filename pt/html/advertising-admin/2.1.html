<!DOCTYPE HTML>
<html lang="en-US" class="html-content">
<head>
	<meta charset="UTF-8">
	<title>新建公告</title>
	<link rel="stylesheet" href="../images/common/base.css" />
    <link rel="stylesheet" href="../images/common/js-ui.css" />
	<link rel="stylesheet" href="../images/admin/admin.css" />
	
	<style>
	.panel-field-urgent {display:none;}
	.ui-form .J-panel-group {margin:0;}
	.checkbox-list {border-bottom:1px dotted #CCC;display:inline-block;padding-bottom:10px;}
	.checkbox-list-last {border:0;}
	</style>
	
    <script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../js/phoenix.base.js"></script>
	<script type="text/javascript" src="../js/phoenix.Class.js"></script>
	<script type="text/javascript" src="../js/phoenix.Event.js"></script>
	<script type="text/javascript" src="../js/phoenix.util.js"></script>
	<script type="text/javascript" src="../js/phoenix.Tab.js"></script>
	<script type="text/javascript" src="../js/phoenix.Hover.js"></script>
	<script type="text/javascript" src="../js/phoenix.Tip.js"></script>
	<script type="text/javascript" src="../js/phoenix.Mask.js"></script>
	<script type="text/javascript" src="../js/phoenix.MiniWindow.js"></script>
	<script type="text/javascript" src="../js/phoenix.Message.js"></script>
	<script type="text/javascript" src="../js/phoenix.DatePicker.js"></script>

	
</head>
<body>
	<div class="menu">
		<div class="menu-logo"></div>
		<ul class="menu-list">
			<li><a href="">首页</a></li>
			<li><a href="">全局</a></li>
			<li><a href="">用户</a></li>
			<li><a href="">游戏</a></li>
			<li><a href="">资金</a></li>
			<li><a href="">市场促销</a></li>
			<li><a href="">统计</a></li>
			<li><a href="">内容</a></li>
			<li><a href="">权限</a></li>
		</ul>
		<div class="menu-quit"><a href="">退出</a><i class="ico-user"></i>你好，vava</div>
	</div>
	<div class="col-content">
		<div class="col-side">
			<dl class="nav">
				<dt>广告</dt>
				<dd class="current"><a href="1.1index.html">广告管理（发布）</a></dd>
				<dd><a href="1.71proxy-list.html">广告管理（审核）</a></dd>
				<dd><a href="1.71proxy-list.html">广告位管理</a></dd>
				<dt>公告</dt>
				<dd><a href="2.1freeze-account-list.html">公告管理（发布）</a></dd>
				<dd><a href="#">公告管理（审核）</a></dd>
				<dd><a href="2.2account-complaints.html">新建公告</a></dd>
				<dt>专题</dt>
				<dd><a href="2.1freeze-account-list.html">专题管理（发布）</a></dd>
				<dd><a href="#">专题管理（查看）</a></dd>
				<dd><a href="2.2account-complaints.html">新建专题</a></dd>
			</dl>
		</div>
		<div class="col-main">
			<div class="col-crumbs"><div class="crumbs"><strong>当前位置：</strong><a href="#">公告</a> &gt; <a href="#">公告管理</a> &gt; 新建公告</div></div>
			<div class="col-content">
				<div class="col-main">
					<div class="main">
						<form action="?" id="J-form">
						<ul class="ui-form">
							<li>
								<label for="name" class="ui-label">公告类型：</label>
								<span class="radio-list" id="J-panel-radio">
									<label for="J-radio-type-1" class="label"><input name="type" type="radio" value="1" class="radio" id="J-radio-type-1" checked="checked">普通</label>
									<label for="J-radio-type-2" class="label"><input name="type" type="radio" value="2" class="radio" id="J-radio-type-2">紧急</label>
								</span>
							</li>
							<li class="panel-field-urgent">
								<label class="ui-label" for="name">展示页面：</label>
								<select id="J-select-page" class="ui-select" name="">
									<option value="">请选择</option>
									<option value="平台顶部">平台顶部</option>
									<option value="重庆时时彩">重庆时时彩</option>
								</select>
								<span class="ui-check"><i></i>请选择页面</span>
							</li>
							<li class="J-panel-group">
								<label for="" class="ui-label">展示用户组：</label>
								<span class="checkbox-list">
									<label for="J-checkbox-all" class="label"><input id="J-checkbox-all" type="checkbox" value="1" class="checkbox">全部客户</label>
								</span>
							</li>

							<li class="J-panel-group">
								<label for="" class="ui-label"></label>
								<span class="checkbox-list">
									<label for="J-usergroup-2" class="label"><input type="checkbox" value="2" class="checkbox" id="J-usergroup-2">总代</label>
									<label for="J-usergroup-3" class="label"><input type="checkbox" value="3" class="checkbox" id="J-usergroup-3">其他代理</label>
									<label for="J-usergroup-10" class="label"><input type="checkbox" value="10" class="checkbox" id="J-usergroup-10">玩家</label>
								</span>
							</li>
							<li class="J-panel-group">
								<label for="" class="ui-label"></label>
								<span class="checkbox-list checkbox-list-last">
									<label for="J-usergroup-11" class="label"><input type="checkbox" value="11" class="checkbox" id="J-usergroup-11">VIP</label>
									<label for="J-usergroup-12" class="label"><input type="checkbox" value="12" class="checkbox" id="J-usergroup-12">非VIP</label>
								</span>
								<span class="ui-check"><i></i>请选择一个用户组</span>
							</li>
							<li>
								<label class="ui-label" for="name">公告标题：</label>
								<input id="J-input-title" type="text" class="input" value=""> <span class="ui-prompt">(限40个字)</span>
								 <span class="ui-check"><i></i>公告标题长度应为1-80个字符</span>
								
							</li>
							<li class="time">
								<label class="ui-label" for="name">有效期：</label>
								<input id="J-input-time-start" type="text" class="input" value=""> - <input id="J-input-time-end" type="text" class="input" value="不限时间" disabled="disabled" />
								<span class="ui-check"><i></i>请选择生效时间</span>
								
							</li>
							<li>
								<label class="ui-label" for="name">公告内容：</label>
								<div class="textarea">
									<textarea id="J-content"  rows="12" cols="80" style="width:100%;height:300px;">
												用虚拟光区就可以直接打开,需要加载的哦! 是SQL Server数据库文件.DVD镜像文件。 mdf和.mds,其实用daemon将这个文件变成光盘里的文件不是很好用的
									</textarea>
									<span class="ui-check"><i></i>公告内容不能为空</span>
									
								</div>
							</li>
							<li id="J-row-push-proxy">
								<label class="ui-label"></label>
								<span class="ui-info"><label for="J-checkbox-proxy" class="label"><input id="J-checkbox-proxy" type="checkbox" value="1" class="checkbox">同步推送到代理首页</label></span>
							</li>
							<li class="ui-btn">
								<a id="J-button-submit" class="btn btn-important" href="javascript:void(0);">提交审核<b class="btn-inner"></b></a>
								<a id="J-button-save" class="btn" href="javascript:void(0);">保 存<b class="btn-inner"></b></a>
							</li>
						</ul>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	
<script>
(function(){
	var Wd = phoenix.Message.getInstance(),timeStart = $('#J-input-time-start'),timeEnd = $('#J-input-time-end'),form = $('#J-form');
	timeStart.focus(function(){
		var dt  = new phoenix.DatePicker({input:timeStart,isShowTime:true,});
		dt.addEvent('afterSetValue', function(){
			checkTime();
		});
		dt.show();
	});
	timeEnd.focus(function(){
		var dt  = new phoenix.DatePicker({input:timeEnd,isShowTime:true,});
		dt.addEvent('afterSetValue', function(){
			timeEnd.attr('data-old-time', dt.input.val());
			checkTime();
		});
		dt.show();
	});
	//是否为紧急公告
	var isUrgent = function(){
		return !!!$('#J-panel-radio').find('input[type="radio"]').get(0).checked;
	};
	
	//类型切换
	$('#J-panel-radio').find('input[type="radio"]').click(function(){
		var oldtime;
		if(this.value == '1'){
			form.find('.panel-field-urgent').hide();
			timeEnd.attr('disabled', true).val('不限时间').addClass('input-disable');
			$('#J-row-push-proxy').show();
		}else{
			oldtime = timeEnd.attr('data-old-time');
			oldtime = !!oldtime ? oldtime : '';
			form.find('.panel-field-urgent').show();
			timeEnd.attr('disabled', false).val(oldtime).removeClass('input-disable');
			$('#J-row-push-proxy').hide();
		}
	});
	
	
	
	
	//检测页面
	var checkPage = function(){
		var dom = $('#J-select-page'),domv = $.trim(dom.val()),isPass = false;
		if(!isUrgent()){
			dom.parent().find('.ui-check').hide();
			return isPass = true;
		}
		if(domv == ''){
			dom.parent().find('.ui-check').show();
			isPass = false;
		}else{
			dom.parent().find('.ui-check').hide();
			isPass = true;
		}
		return isPass;
	};
	$('#J-select-page').change(function(){
		checkPage();
	});
	
	
	//检测用户组
	var checkGroup = function(){
		var	ipts = $('.J-panel-group').find('input[type="checkbox"]'),isPass = false,checkNum = 0;
			ipts.each(function(){
				if(this.checked){
					checkNum += 1;
				}
			});
			if(checkNum < 1){
				$('.J-panel-group').find('.ui-check').show();
				isPass = false;
			}else{
				$('.J-panel-group').find('.ui-check').hide();
				isPass = true;
			}
		return isPass;
	};
	$('.J-panel-group').on('click', 'input[type="checkbox"]', function(){
		checkGroup();
	});
	$('.J-panel-group').find('input[type="checkbox"]').click(function(){
		if(this.checked){
			$('.J-panel-group').find('.ui-check').hide();
		}
		checkGroup();
	});
	//选择全部客户
	$('#J-checkbox-all').click(function(){
		var me = this,ipts = $('.J-panel-group').find('input[type="checkbox"]');
		if(this.checked){
			ipts.each(function(){
				if(me != this){
					this.disabled = true;
					this.checked = true;
				}
			});
		}else{
			ipts.each(function(){
				if(me != this){
					this.disabled = false;
					this.checked = false;
				}
			});
		}
		checkGroup();
	});
	
	
	
	
	//检测标题
	var checkTitle = function(){
		var dom = $('#J-input-title'),domv = $.trim(dom.val()),isPass = false;
		if(domv == ''){
			dom.parent().find('.ui-check').html('<i></i>公告标题不能为空').show();
			isPass = false;
		}else if(domv.length > 40){
			dom.parent().find('.ui-check').html('<i></i>公告标题长度不能超过40个字符').show();
			isPass = false;
		}else{
			dom.parent().find('.ui-check').hide();
			isPass = true;
		}
		return isPass;
	};
	$('#J-input-title').blur(function(){
		checkTitle();
	});
	
	//检测生效期
	var checkTime = function(){
		var dom = $('#J-input-time-start'),domv = $.trim(dom.val()),isPass = false,
			dom2 = $('#J-input-time-end'),dom2v = $.trim(dom2.val());
		if(isUrgent()){
			if(domv == '' || dom2v == ''){
				dom.parent().find('.ui-check').show();
				isPass = false;
			}else{
				dom.parent().find('.ui-check').hide();
				isPass = true;
			}
		}else{
			if(domv == ''){
				dom.parent().find('.ui-check').show();
				isPass = false;
			}else{
				dom.parent().find('.ui-check').hide();
				isPass = true;
			}
		}
		return isPass;
	};
	
	
	
	//检测内容
	var checkContent = function(){
		var dom = $('#J-content'),domv = $.trim(dom.val()),isPass = false;
		if(domv == ''){
			dom.parent().find('.ui-check').show();
			isPass = false;
		}else{
			dom.parent().find('.ui-check').hide();
			isPass = true;
		}
		return isPass;
	};
	
	
	
	$('#J-button-submit').click(function(){
		if(checkPage() && checkGroup() && checkTitle() && checkTime() && checkContent()){
			submitForm();
			//$('#J-form').submit();
		}
		
	});
	$('#J-button-save').click(function(){
		if(checkGroup() && checkTitle() && checkTime() && checkContent()){
			submitForm();
			//$('#J-form').attr('action', '?action=save').submit();
		}
	});
	
	
	var submitForm = function(){
		var typev,pagev,groupv,titlev,contentv,starttime,endtime,ispush;
		
		typev = isUrgent() ? '2' : '1';
		
		pagev = $('#J-select-page').val();
		
		groupv = [];
		$('.J-panel-group').find('input[type="checkbox"]').each(function(){
			if(this.checked){
				groupv.push(this.value);
			}
		});
		groupv = groupv.join(',');
		
		titlev = $.trim($('#J-input-title').val());
		
		contentv = $('#J-content').val();
		
		ispush = $('#J-checkbox-proxy').get(0).checked ? '1' : '';
		
		
			$.ajax({
				url:'data.json',
				data:{type:typev,page:pagev,group:groupv,title:titlev,content:contentv,startime:starttime,endtime:endtime,ispush:ispush},
				dataType:'json',
				success:function(data){
					data = {isSuccess:1,msg:'',data:{}};
					if(Number(data['isSuccess']) == 1){
						Wd.show({
							mask:true,
							title:'提示',
							confirmText:'继续创建',
							cancelText:'进入管理',
							content:'<div class="bd text-center"><div class="pop-title"><i class="ico-success"></i><h4 class="pop-text">创建成功</h4></div></div>',
							confirmIsShow:true,
							cancelIsShow:true,
							confirmFun:function(){
								Wd.hide();
								location.href = location.href;
							},
							cancelFun:function(){
								Wd.hide();
								location.href = '1.7.html';
							},
							callback:function(){
							}
						});
					}else{
						alert(data['msg']);
					}
					
				}
			});
	};
	
})();
</script>
	

	
<script type="text/javascript" src="../js/xheditor121/jquery/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="../js/xheditor121/xheditor-1.2.1.min.js"></script>
<script type="text/javascript" src="../js/xheditor121/xheditor_lang/zh-cn.js"></script>
<script>
var editor = $('#J-content').xheditor({upImgUrl:"upload.php",upImgExt:"jpg,jpeg,gif,png"});
</script>
	
	
	
</body>
</html>